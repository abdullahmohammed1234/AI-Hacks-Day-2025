<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password - Track2Give</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div
      style="
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #10b981 0%, #f59e0b 100%);
        padding: 1rem;
      "
    >
      <div class="card" style="max-width: 450px; width: 100%">
        <!-- Header -->
        <div style="text-align: center; margin-bottom: 2rem">
          <a href="/" style="text-decoration: none; color: inherit">
            <h1
              style="
                margin: 0;
                background: linear-gradient(135deg, #10b981 0%, #f59e0b 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
              "
            >
              Track2Give
            </h1>
          </a>
          <p style="margin: 0.5rem 0 0 0; color: #6b7280">
            Create a new password
          </p>
        </div>

        <!-- Success Message (if password reset successful) -->
        <% if (typeof success !== 'undefined' && success) { %>
        <div
          style="
            background: #d1fae5;
            color: #065f46;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
          "
        >
          <p style="margin: 0; font-weight: 600">
            ‚úì Password Reset Successful!
          </p>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem">
            You can now log in with your new password.
          </p>
          <a
            href="/login"
            class="btn btn-primary"
            style="margin-top: 1rem; display: inline-block"
          >
            Go to Login
          </a>
        </div>
        <% } else { %>

        <!-- Error Message -->
        <% if (typeof error !== 'undefined' && error) { %>
        <div
          style="
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
          "
        >
          <%= error %>
        </div>
        <% } %>

        <!-- Invalid/Expired Token Warning -->
        <% if (typeof invalidToken !== 'undefined' && invalidToken) { %>
        <div
          style="
            background: #fef3c7;
            color: #92400e;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
          "
        >
          <p style="margin: 0; font-weight: 600">‚ö†Ô∏è Invalid or Expired Link</p>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem">
            This password reset link is invalid or has expired.
          </p>
          <a
            href="/forgot-password"
            class="btn btn-primary"
            style="margin-top: 1rem; display: inline-block"
          >
            Request New Link
          </a>
        </div>
        <% } else { %>

        <!-- Instructions -->
        <div
          style="
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin-bottom: 1.5rem;
          "
        >
          <p style="margin: 0; color: #0c4a6e; font-size: 0.875rem">
            Enter your new password below. Make sure it's at least 6 characters
            long.
          </p>
        </div>

        <!-- Reset Password Form -->
        <form
          method="POST"
          action="/reset-password/<%= token %>"
          onsubmit="return validatePassword()"
        >
          <div style="margin-bottom: 1.5rem">
            <label
              for="password"
              style="
                display: block;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: #374151;
              "
            >
              New Password
            </label>
            <input
              type="password"
              id="password"
              name="password"
              required
              minlength="6"
              placeholder="Enter new password"
              style="
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #d1d5db;
                border-radius: 8px;
                font-size: 1rem;
              "
            />
            <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.75rem">
              At least 6 characters
            </p>
          </div>

          <div style="margin-bottom: 1.5rem">
            <label
              for="confirmPassword"
              style="
                display: block;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: #374151;
              "
            >
              Confirm New Password
            </label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              required
              minlength="6"
              placeholder="Confirm new password"
              style="
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #d1d5db;
                border-radius: 8px;
                font-size: 1rem;
              "
            />
          </div>

          <!-- Password Match Error -->
          <div
            id="password-error"
            style="
              display: none;
              background: #fee2e2;
              color: #991b1b;
              padding: 0.75rem;
              border-radius: 6px;
              margin-bottom: 1rem;
              font-size: 0.875rem;
            "
          >
            Passwords do not match
          </div>

          <button
            type="submit"
            class="btn btn-primary"
            style="width: 100%; margin-bottom: 1rem"
          >
            Reset Password
          </button>
        </form>

        <!-- Back to Login -->
        <div style="text-align: center; margin-top: 1.5rem">
          <p style="margin: 0; color: #6b7280; font-size: 0.875rem">
            Remember your password?
            <a
              href="/login"
              style="
                color: var(--primary-purple);
                text-decoration: none;
                font-weight: 600;
              "
            >
              Back to Login
            </a>
          </p>
        </div>

        <!-- Security Info -->
        <div
          style="
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
          "
        >
          <p
            style="
              margin: 0;
              color: #9ca3af;
              font-size: 0.75rem;
              text-align: center;
            "
          >
            üîí Your password is encrypted and stored securely.
          </p>
        </div>

        <% } %> <% } %>
      </div>
    </div>

    <script>
      function validatePassword() {
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const errorDiv = document.getElementById("password-error");

        if (password !== confirmPassword) {
          errorDiv.style.display = "block";
          return false;
        }

        errorDiv.style.display = "none";
        return true;
      }

      // Real-time validation
      document
        .getElementById("confirmPassword")
        ?.addEventListener("input", function () {
          const password = document.getElementById("password").value;
          const confirmPassword = this.value;
          const errorDiv = document.getElementById("password-error");

          if (confirmPassword.length > 0 && password !== confirmPassword) {
            errorDiv.style.display = "block";
          } else {
            errorDiv.style.display = "none";
          }
        });
    </script>
  </body>
</html>
