<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipe Suggestions - Track2Give</title>
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/css/recipes.css" />
  </head>
  <body>
    <%- include('partials/header') %>

    <main class="container main-content">
      <section class="page-header mb-2">
        <h1>üç≥ Recipe Suggestions</h1>
        <p class="page-description">
          Cook delicious meals with ingredients you already have
        </p>
      </section>

      <div class="dashboard-grid">
        <!-- LEFT COLUMN (top-left: Your Ingredients) -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Your Ingredients</h2>
          </div>

          <!-- Make list scrollable -->
          <div class="ingredients-scroll">
            <% if (!allFoodItems || allFoodItems.length === 0) { %>
            <div class="empty-ingredients">
              <p>üì¶</p>
              <p>No ingredients found</p>
              <a href="/dashboard" class="btn btn-primary mt-2">Add Items</a>
            </div>
            <% } else { %>
            <p class="ingredients-count">
              Showing <%= allFoodItems.length %> food item<%=
              allFoodItems.length > 1 ? 's' : '' %>
            </p>

            <div class="ingredients-grid">
              <% allFoodItems.forEach(item => { const daysUntil = Math.ceil((new
              Date(item.expiryDate) - new Date()) / (1000 * 60 * 60 * 24)); %>
              <label class="ingredient-item">
                <input
                  type="checkbox"
                  class="ingredient-checkbox"
                  value="<%= item.name %>"
                  checked
                />
                <span class="ingredient-icon"
                  ><%= item.categoryIcon || '' %></span
                >
                <div class="ingredient-details">
                  <div class="ingredient-name"><%= item.name %></div>
                  <div class="ingredient-quantity">
                    <%= item.quantity %> <%= item.unit %>
                  </div>
                </div>
                <span
                  class="badge badge-<%= daysUntil <= 1 ? 'danger' : daysUntil <= 3 ? 'warning' : 'info' %>"
                >
                  <%= daysUntil <= 0 ? 'Now' : daysUntil + 'd' %>
                </span>
              </label>
              <% }); %>
            </div>
            <% } %>
          </div>

          <!-- Buttons side-by-side -->
          <div
            class="card-footer"
            style="display: flex; gap: 0.5rem; margin-top: 1rem"
          >
            <a
              href="/add-food-item"
              class="btn btn-outline"
              style="flex: 1; text-align: center"
              >Add More Ingredients</a
            >
          </div>
        </div>

        <!-- RIGHT COLUMN (top-right: AI Generated Meal) -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">ü§ñ AI-Chef</h2>
            <p class="cuisine-description">
              Pick a cuisine style, then click Suggest
            </p>
          </div>

          <!-- Cuisine suggestion boxes (6 tiles: 3 + 3) -->
          <div id="cuisineGrid" class="cuisine-grid">
            <!-- we will render cuisine options dynamically from JS -->
          </div>
          <!-- Small action row -->
          <div class="action-row bottom-2px">
            <button
              onclick="generateRecipeWithAI()"
              class="btn btn-primary action-button"
            >
              Suggest Recipes
            </button>
          </div>
          <!-- AI chef -->
          <!-- Two larger AI result boxes -->
          <div class="ai-result-grid">
            <div id="aiLarge1" class="ai-large-tile card ai-large">
              <div id="ai-loading-top" class="loading-area">
                <div class="loading-spinner" style="margin: 0.5rem auto"></div>
                <div class="loading-text">Let him cook...</div>
              </div>
              <div id="ai-content-top" class="ai-content">
                <p class="ai-suggestion-title">Recipe 1</p>
                <p class="ai-suggestion-text">
                  Recipes based on the selected cuisine and ingredients.
                </p>
              </div>
            </div>
            <div id="aiLarge2" class="ai-large-tile card ai-large">
              <div id="ai-loading-bottom" class="loading-area">
                <div class="loading-spinner" style="margin: 0.5rem auto"></div>
                <div class="loading-text">Let him cook...</div>
              </div>
              <div id="ai-content-bottom" class="ai-content">
                <p class="ai-suggestion-title">Recipe 2</p>
                <p class="ai-suggestion-text">
                  Recipes based on the selected cuisine and ingredients.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- end dashboard-grid -->

      <!-- Favourites box (full width, below top two) -->
      <div class="card mt-3">
        <div class="card-header">
          <h2 class="card-title">‚ù§Ô∏è Favourites</h2>
        </div>

        <div id="saved-recipes-area" class="card-body">
          <div id="saved-grid" class="saved-grid">
            <!-- saved meal cards rendered by JS -->
          </div>

          <div class="recipe-pagination">
            <button id="prevPageBtn" class="btn btn-outline">‚Üê Previous</button>
            <div class="pagination-text">
              Page <span id="savedPage">1</span> of
              <span id="savedTotalPages">1</span>
            </div>
            <button id="nextPageBtn" class="btn btn-outline">Next ‚Üí</button>
          </div>
        </div>
      </div>
    </main>

    <%- include('partials/footer') %>

    <!-- Pass server data to client -->
    <script>
      // Server-provided data
      window.savedMealsData = <%- JSON.stringify(typeof savedMeals !== 'undefined' ? savedMeals : []) %>;
    </script>
    <div id="aiModal" class="modal-overlay" style="display: none">
      <div class="modal-content card">
        <div class="modal-header">
          <h3 id="modalTitle" class="modal-title"></h3>
          <button onclick="closeModal()" class="btn btn-outline modal-close">
            ‚úñ
          </button>
        </div>
        <div id="modalIngredients" class="modal-body"></div>
        <div class="modal-footer">
          <button onclick="closeModal()" class="btn btn-primary">Close</button>
        </div>
      </div>
    </div>
    <!-- Include external JavaScript -->
    <script src="/js/recipes.js"></script>
  </body>
</html>
